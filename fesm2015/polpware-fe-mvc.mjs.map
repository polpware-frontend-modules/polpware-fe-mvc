{"version":3,"file":"polpware-fe-mvc.mjs","sources":["../../../../projects/polpware/fe-mvc/src/lib/mediators/noop-view-instance.ts","../../../../projects/polpware/fe-mvc/src/lib/mediators/abstract-list.ts","../../../../projects/polpware/fe-mvc/src/lib/mediators/ngstore-abstract-list.ts","../../../../projects/polpware/fe-mvc/src/lib/mediators/writable-abstract-list.ts","../../../../projects/polpware/fe-mvc/src/lib/mediators/rxjs-powered-writable-abstract-list.ts","../../../../projects/polpware/fe-mvc/src/lib/controllers/list-controller.ts","../../../../projects/polpware/fe-mvc/src/polpware-fe-mvc.ts"],"sourcesContent":["import * as dependencies from '@polpware/fe-dependencies';\r\n\r\nimport { IViewInstance } from './interfaces';\r\n\r\nconst _ = dependencies.underscore;\r\nconst noop = _.noop;\r\n\r\nexport const noopViewInstance: IViewInstance = {\r\n    $data: {\r\n        init: noop,\r\n        setRefreshCallback: noop,\r\n        setInfiniteCallback: noop,\r\n        clean: noop,\r\n        asyncPush: noop,\r\n        syncPush: noop,\r\n        asyncPop: noop,\r\n        syncPop: noop,\r\n        asyncPrepend: noop,\r\n        syncPrepend: noop,\r\n        asyncRefresh: noop,\r\n        syncRefresh: noop,\r\n        hasMoreData: noop,\r\n        getItems: noop,\r\n        setupSearch: noop,\r\n        updateSearchCriteria: noop,\r\n        getAncestor: noop\r\n    },\r\n    $loader: {\r\n        show: noop,\r\n        hide: noop\r\n    },\r\n    $refresher: {\r\n        show: noop,\r\n        hide: noop\r\n    },\r\n    $moreLoader: {\r\n        show: noop,\r\n        hide: noop\r\n    },\r\n    $router: {\r\n        go: noop\r\n    },\r\n    $render: {\r\n        ready: noop,\r\n        destroy: noop,\r\n        asyncDigest: noop\r\n    },\r\n    $navBar: {\r\n        /**\r\n         * Get current state\r\n         * @returns {}\r\n         */\r\n        getState: noop,\r\n        /**\r\n         * Set state\r\n         * @param {Boolean} s\r\n         */\r\n        setState: noop\r\n    },\r\n    $modal: {\r\n        setData: noop,\r\n        getData: noop,\r\n        build: noop\r\n    },\r\n    $popover: {\r\n        setData: noop,\r\n        getData: noop,\r\n        build: noop,\r\n        onHidden: noop\r\n    },\r\n    $popup: {\r\n        setData: noop,\r\n        getData: noop,\r\n        build: noop,\r\n        confirm: noop,\r\n        prompt: noop,\r\n        alert: noop\r\n    },\r\n    $progressBar: {\r\n        create: noop,\r\n        reset: noop,\r\n        createInfinite: noop,\r\n        onProgress: noop,\r\n        destroy: noop,\r\n        destroyInfinite: noop,\r\n        showAbort: noop\r\n    },\r\n    $alertify: noop,\r\n    $history: {\r\n        goBack: noop\r\n    }\r\n};\r\n","/**\n * @fileOverview\n * An mediator (named after the mediator pattern)\n * which coordinates views and controllers.\n * We support the following use cases:\n * 1. A page is first time loaded and then rendered\n * 2. A page is refreshed by pulling down\n * 3. A page is rendered with more data\n * 4. A page is updated after some state has changed\n *\n * Note that this is an sbtract class; you cannot create an instance of it.\n */\n\nimport * as dependencies from '@polpware/fe-dependencies';\n\nconst ClassBuilder = dependencies.Class;\n\nimport { lift as liftIntoPromise, tojQueryDeferred } from '@polpware/fe-utilities';\n\nimport { IViewInstance } from './interfaces';\nimport { noopViewInstance } from './noop-view-instance';\n\nconst _ = dependencies.underscore;\n\nexport interface IListMediatorCtorOptions {\n    dataProvider?: any;\n    dataParams?: any;\n    deepCopy?: boolean;\n    useModel?: boolean;\n    enableRefresh: boolean;\n    enableInfinite: boolean;\n}\n\nexport interface IListMediatorPublic {\n\n    dataProvider(value?: any): any;\n    dataParams(value?: any): any;\n\n    viewInsance(value?: IViewInstance): IViewInstance;\n\n    startService(viewInsance: IViewInstance, fromCache?: boolean): void;\n    stopService(): void;\n\n    loadInitData(): PromiseLike<any>;\n    refresh(isProgramatic?: boolean): PromiseLike<any>;\n    loadMore(): PromiseLike<any>;\n\n    renderData(async?: boolean): void;\n\n    setUp(options?: any): void;\n    tearDown(): void;\n}\n\nexport interface IListMediatorDev extends IListMediatorPublic {\n    _settings: IListMediatorCtorOptions;\n    _viewInstance: IViewInstance;\n    _dataProvider: any;\n    _dataParams: any;\n    _deepCopy: boolean;\n    _useModel: boolean;\n    _enableRefresh: boolean;\n    _enableInfinite: boolean;\n\n    _stateContext: any;\n\n    _isInit: boolean;\n    _isLoadingData: boolean;\n\n    safelyReadDataProvider(): any[];\n    generateItemsInternal(collection: any): any[];\n\n    onUpdateView(evt: any): any;\n    generateItems(async?: boolean): void;\n\n    _defaultStartService(): void;\n\n    attachView(viewInstance): void;\n    detachView(): void;\n\n    startServiceImpl(): void;\n}\n\nexport const ListMediator = ClassBuilder.extend({\n\n    Properties: 'dataProvider,dataParams,deepCopy,useModel,enableRefresh,enableInfinite,onUpdateView,viewInstance',\n\n    init: function(settings: IListMediatorCtorOptions) {\n        const self: IListMediatorDev = this;\n        self._settings = settings;\n        self._viewInstance = noopViewInstance;\n        self._dataProvider = settings.dataProvider || null;\n        self._dataParams = settings.dataParams || {};\n        self._deepCopy = settings.deepCopy || false;\n        self._useModel = settings.useModel || false;\n        self._enableRefresh = settings.enableRefresh || false;\n        self._enableInfinite = settings.enableInfinite || false;\n\n        self._stateContext = {};\n        self._isInit = true;\n        self._isLoadingData = false;\n    },\n\n    generateItemsInternal: function(collection): any[] {\n        const self: IListMediatorDev = this;\n        const newData = [];\n        if (self._useModel) {\n            collection.forEach(function(item) {\n                newData.push(item);\n            });\n        } else if (self._deepCopy) {\n            collection.forEach(function(item) {\n                newData.push(_.extend({}, item.attributes));\n            });\n        } else {\n            collection.forEach(function(item) {\n                newData.push(item.attributes);\n            });\n        }\n        return newData;\n    },\n\n\n    /**\n     * Computes the set of models in the current data provider.\n     * Note that we support all kinds of data providers, backbone\n     * or something similar backbone.\n     * Moreover, this method may be overriden.\n     * @returns {Array}\n     */\n    safelyReadDataProvider: function(): any[] {\n        const self: IListMediatorDev = this;\n        let models: any;\n        if (self._dataProvider.models) {\n            models = self._dataProvider.models;\n        } else {\n            models = [];\n            self._dataProvider.forEach(function(oneItem) {\n                models.push(oneItem);\n            });\n        }\n        return models;\n    },\n\n    /**\n     * Generates the items for the view\n     * Note that we only perform the checking in this method;\n     * it is Not necessary to peform this kind of checking in other overriden generateItems.\n     * @param {Boolean} async\n     * @returns {}\n     */\n    generateItems: function(async): void {\n        const self: IListMediatorDev = this;\n        const $data = self._viewInstance.$data;\n        const models = self.safelyReadDataProvider();\n        const newData = self.generateItemsInternal(models);\n        // newData is ready\n        if (async === true) {\n            self.onUpdateView({\n                add: true,\n                source: 'remote',\n                data: newData\n            });\n            $data.asyncPush(newData);\n        } else {\n            self.onUpdateView({\n                add: true,\n                source: 'cache',\n                data: newData\n            });\n            $data.syncPush(newData);\n        }\n    },\n\n    /**\n     * Load the first page of data from the server,\n     * without any loading indicator;\n     * This method is used internally.\n     * @function loadInitData\n     * @returns {Promise}\n     */\n    loadInitData: function(): PromiseLike<any> {\n        const self: IListMediatorDev = this;\n\n        const dataProvider = self._dataProvider;\n        // We must reset data beforehand\n        dataProvider.reset();\n        // There are side effects if a parameter is passed in get*page\n        // Therefore, we need to clone a new copy of this parameter\n        self._isLoadingData = true;\n\n        const dataParams = self._dataParams;\n        let promise = dataProvider.getFirstPage({ data: _.extend({}, dataParams) });\n        promise = tojQueryDeferred(promise);\n        promise.always(function() {\n            self._isInit = false;\n            self._isLoadingData = false;\n        });\n\n        return promise.then(function() {\n            const $data = self._viewInstance.$data;\n            $data.clean();\n            $data.hasMoreData(dataProvider.hasNextPage());\n            self.generateItems(true /*aync*/);\n            // To ensure that isLoadingData happends very late.\n        });\n    },\n\n    /**\n     * Render data without any loading operations. By default, this is invoked\n     * in the context of non-async mode.\n     * @param {Boolean} async\n     * @function renderData\n     */\n    renderData: function(async?: boolean): void {\n        const self: IListMediatorDev = this;\n        const $data = self._viewInstance.$data;\n        $data.clean();\n        $data.hasMoreData(self._dataProvider.hasNextPage());\n        self.generateItems(async === true);\n    },\n\n    /**\n     * Reloads data as the result of pulling down operation.\n     * It assumes that the user has pulled down the page, thus resetting the refreshing\n     * indicator at the end.\n     * @param isProgramatic {Boolean} Indicates if this invocation\n     * is due to an internal call, without user interaction.\n     * @function refresh\n     */\n    refresh: function(isProgramatic?: boolean): PromiseLike<any> {\n        const self: IListMediatorDev = this;\n        const $data = self._viewInstance.$data;\n        const $refresher = self._viewInstance.$refresher;\n        $data.hasMoreData(true);\n        // Refresh loader\n        $refresher.show(isProgramatic);\n        const prms = self.loadInitData();\n        const anotherP = tojQueryDeferred(prms);\n        return anotherP.always(function() {\n            $refresher.hide(isProgramatic);\n        });\n    },\n\n    /**\n     * Loads more data as the result of scrolling down.\n     * It assumes that the user has scroll down enough, thus resetting the loading more\n     * indicator at the end.\n     * @function loadMore\n     */\n    loadMore: function(): PromiseLike<any> {\n\n        const self: IListMediatorDev = this;\n        const dataProvider = self._dataProvider;\n        const dataParams = self._dataParams;\n        const $data = self._viewInstance.$data;\n        const $moreLoader = self._viewInstance.$moreLoader;\n\n        // loadMore may be issued before init\n        if (self._isInit) {\n            return liftIntoPromise(true, null);\n        }\n\n        if (self._isLoadingData) {\n            // We do not disable infinite scroll complete ...\n            // because we want to prevent from two time loadMore\n            // and one disable finally is sufficient to remove inifinite scroll indicator.\n            return liftIntoPromise(true, null);\n        }\n\n        if (!dataProvider.hasNextPage()) {\n            $data.hasMoreData(false);\n            return liftIntoPromise(true, null);\n        }\n\n        $moreLoader.show();\n\n        // We must clone a copy dataParams, as there are side\n        // effects in this parameter\n        self._isLoadingData = true;\n        const prms = dataProvider.getNextPage({ data: _.extend({}, dataParams) }).then(function() {\n            $data.hasMoreData(dataProvider.hasNextPage());\n            self.generateItems(true /* async */);\n            // To ensure that isLoading happends very later, we have to put isLoading in two functions.\n            self._isLoadingData = false;\n        }, function() {\n            self._isLoadingData = false;\n        });\n        const anotherP = tojQueryDeferred(prms);\n\n        return anotherP.always(function() {\n            $moreLoader.hide();\n        });\n    },\n\n    /**\n     * Check if the context for the data provider has changed, for\n     * the purpose of deciding if we need to reload data.\n     * @function stateChanged\n     * @returns {Boolean}\n     */\n    stateChanged: function() {\n        const stateContext = this._stateContext;\n        if (stateContext.enableSearch === true) {\n            return stateContext.searchModel.isConfirmed() && stateContext.searchModel.hashCode() !== stateContext.searchCriteria.hashCode;\n        }\n        return true;\n    },\n\n    /**\n     * Updates state and reload data, with loading indicator if set\n     * @function updateStateAndReload\n     */\n    updateStateAndReload: function() {\n        const self = this;\n        const stateContext = self._stateContext;\n        const $data = self._viewInstance.$data;\n        const $loader = self._viewInstance.$loader;\n        if (stateContext.enableSearch === true) {\n            stateContext.searchCriteria = stateContext.searchModel.generateFilter();\n            self.dataParams(stateContext.searchCriteria.filter);\n            $data.updateSearchCriteria(stateContext.searchCriteria);\n        }\n        $loader.show();\n        const prms = self.loadInitData();\n        const anotherP = tojQueryDeferred(prms);\n\n        anotherP.always(function() {\n            $loader.hide();\n        });\n    },\n\n    /**\n     * Sets up context and hooks up data with view.\n     * This method is only invoked once and should be one of the steps following constructor.\n     * In other words, it is part of a constructor.\n     * @param {Object} options\n     */\n    setUp: function(options) {\n        const self = this;\n\n        options = options || {};\n\n        if (options.enableSearch) {\n            self._stateContext.enableSearch = true;\n            // We expect the following properties\n            // chai.expect(options).to.have.property('searchSettings');\n            // chai.expect(options.searchSettings).to.have.property('searchModel');\n            // chai.expect(options.searchSettings).to.have.property('searchModelGuid');\n            // chai.expect(options.searchSettings).to.have.property('searchURL');\n            // Create our state context\n            // Keep the search settings into the state context,\n            // because these settings are used later for deciding if we\n            // need to recompute data parameters or not\n            const searchSettings = options.searchSettings;\n            self._stateContext.searchURL = searchSettings.searchURL;\n            self._stateContext.searchModelGuid = searchSettings.searchModelGuid;\n            self._stateContext.searchModel = searchSettings.searchModel;\n            self._stateContext.searchCriteria = searchSettings.searchModel.generateFilter();\n            self.dataParams(self._stateContext.searchCriteria.filter);\n        }\n    },\n\n    /**\n     * A destructor.\n     */\n    tearDown: function() {\n        const self: IListMediatorDev = this;\n        if (self._dataProvider && self._dataProvider.off) {\n            // Discard all listening\n            self._dataProvider.off('all');\n            // Discard all data\n            self._dataProvider.reset();\n        }\n    },\n\n    /**\n     * Start to bind a view to this mediator.\n     */\n    attachView: function(viewInstance): void {\n        const self: IListMediatorDev = this;\n        self._viewInstance = viewInstance;\n\n        const $data = self._viewInstance.$data;\n        if (self._enableRefresh) {\n            $data.setRefreshCallback(function() {\n                self.refresh();\n            });\n        }\n        if (self._enableInfinite) {\n            $data.setInfiniteCallback(function() {\n                self.loadMore();\n            });\n        }\n        if (self._stateContext.enableSearch) {\n            $data.setupSearch(self._stateContext.searchCriteria, function() {\n                self._viewInstance.$router.go(self._stateContext.searchURL, {\n                    dataId: self._stateContext.searchModelGuid\n                });\n            });\n        }\n\n        $data.init();\n    },\n\n    detachView: function(): void {\n        const self: IListMediatorDev = this;\n        self._viewInstance = noopViewInstance;\n    },\n\n    _defaultStartService: function(): void {\n        const self: IListMediatorDev = this;\n        const $loader = self._viewInstance.$loader;\n        $loader.show();\n        const promise = self.loadInitData();\n        const anotherP = tojQueryDeferred(promise);\n        anotherP.always(function() {\n            $loader.hide();\n        });\n    },\n\n    /**\n     * This method needs to be overrided.\n     */\n    startServiceImpl: function(): void {\n        const self: IListMediatorDev = this;\n        self._defaultStartService();\n    },\n\n    startService: function(viewInsance: IViewInstance, fromCache?: boolean): void {\n        const self: IListMediatorDev = this;\n        self.attachView(viewInsance);\n        if (fromCache === true) {\n            self.renderData();\n        } else {\n            self.startServiceImpl();\n        }\n    },\n\n    stopService: function(): void {\n        const self = this;\n        self.detachView();\n    }\n\n});\n\n\n\n\n\n\n\n","import {\r\n    ICollectionItem, ICollectionStore\r\n} from '@polpware/fe-data';\r\n\r\n\r\nimport {\r\n    ListMediator,\r\n    IListMediatorCtorOptions,\r\n    IListMediatorPublic,\r\n    IListMediatorDev\r\n} from './abstract-list';\r\n\r\nexport {\r\n    IListMediatorCtorOptions,\r\n} from './abstract-list';\r\n\r\nexport interface INgStoreListMediatorPublic extends IListMediatorPublic {\r\n    setNgStore<T extends ICollectionItem>(store: ICollectionStore<T>): void;\r\n    getNgStore<T extends ICollectionItem>(): ICollectionStore<T>;\r\n}\r\n\r\nexport interface INgStoreListMediatorDev extends IListMediatorDev {\r\n    _ngStore: ICollectionStore<any>;\r\n    _super(value?: any): any;\r\n}\r\n\r\nexport const NgStoreListMediator = ListMediator.extend({\r\n\r\n    init: function(settings: IListMediatorCtorOptions) {\r\n        const self: INgStoreListMediatorDev = this;\r\n        self._super(settings);\r\n        self._ngStore = null;\r\n    },\r\n\r\n    setNgStore: function <T extends ICollectionItem>(store: ICollectionStore<T>): void {\r\n        const self: INgStoreListMediatorDev = this;\r\n        self._ngStore = store;\r\n    },\r\n\r\n    getNgStore: function <T extends ICollectionItem>(): ICollectionStore<T> {\r\n        const self: INgStoreListMediatorDev = this;\r\n        return self._ngStore;\r\n    },\r\n\r\n    safelyReadDataProvider: function(): any[] {\r\n        const self: INgStoreListMediatorDev = this;\r\n        const models = self._super();\r\n        // Safely push these models into view level data provider\r\n        self._ngStore.add(models);\r\n        // Then return\r\n        return models;\r\n    },\r\n\r\n    /**\r\n     * Override.\r\n     * This method uses the data from the ngstore, instead of the\r\n     * the current remote data provider, to generate the list of data\r\n     * to be rendered.\r\n     */\r\n    renderData: function(async?: boolean) {\r\n        const self: INgStoreListMediatorDev = this;\r\n        const $data = self._viewInstance.$data;\r\n        $data.clean();\r\n        $data.hasMoreData(self._dataProvider.hasNextPage());\r\n\r\n        const subscription = self._ngStore.getState().subscribe(savedData => {\r\n\r\n            const newData = self.generateItemsInternal(savedData.items);\r\n            if (async === true) {\r\n                $data.asyncPush(newData);\r\n            } else {\r\n                $data.syncPush(newData);\r\n            }\r\n\r\n            setTimeout(() => {\r\n                subscription.unsubscribe();\r\n            }, 1);\r\n        });\r\n    }\r\n\r\n});\r\n","/**\n * @fileOverview\n * This module implements a list mediator that may quickly\n * get updated on any operation in this list.\n * E.g., add, remove, update\n */\n\n\nimport * as dependencies from '@polpware/fe-dependencies';\nimport {\n    ListMediator,\n    IListMediatorCtorOptions,\n    IListMediatorPublic,\n    IListMediatorDev\n} from './abstract-list';\n\nconst _ = dependencies.underscore;\nconst backbone = dependencies.backbone;\n\nexport interface IChangeSet {\n    changes: {\n        added: any[],\n        removed: any[],\n        merged: any[]\n    };\n}\n\nexport interface IWritableListMediatorCtorOptions\n    extends IListMediatorCtorOptions {\n    globalProvider?: any;\n    filterFlags?: {\n        added?: boolean,\n        removed?: boolean,\n        updated?: boolean\n    };\n}\n\nexport interface IWritableListMediatorPublic\n    extends IListMediatorPublic {\n\n    viewLevelData(value?: any): any;\n    globalProvider(value?: any): any;\n\n    globalProviderFilter(evtCtx: any, changeSet: IChangeSet, rest: any): IChangeSet;\n}\n\nexport interface IWritableListMediatorDev extends IListMediatorDev {\n    _viewLevelData: any;\n    _viewProviderListeners: any;\n    _globalProvider: any;\n    _globalProviderListeners: any;\n    _filterFlags: {\n        added?: boolean,\n        removed?: boolean,\n        updated?: boolean\n    };\n\n    _super(value?: any): any;\n\n    globalProviderFilter(evtCtx: any, changeSet: IChangeSet, rest: any): IChangeSet;\n    onGlobalProviderUpdate();\n\n    onViewProviderUpdate(evtCtx: any, changeSet: IChangeSet, rest: any): void;\n\n    startListeningGlobalProvider(globalProvider);\n    stopListeningGlobalProvider();\n\n    startListeningViewProvider();\n    stopListeningViewProvider();\n\n    findAtIndex(newModel: any): number;\n}\n\nexport const WritableListMediator = ListMediator.extend({\n\n    Properties: 'viewLevelData,globalProvider',\n\n    init: function(settings: IWritableListMediatorCtorOptions) {\n        const self: IWritableListMediatorDev = this;\n        self._super(settings);\n\n        const CollectionCtor = backbone.Collection.extend();\n        self._viewLevelData = new CollectionCtor();\n        self._viewProviderListeners = {};\n        self._globalProvider = settings.globalProvider || null;\n        self._globalProviderListeners = {};\n        self._filterFlags = settings.filterFlags || { added: true, removed: true, updated: true };\n    },\n\n    /**\n     * A filter on the global data provider.\n     * @returns {Boolean}\n     */\n    globalProviderFilter: function(evtCtx: any, changeSet: IChangeSet, rest: any): IChangeSet {\n        /*jslint unparam:true */\n        const self: IWritableListMediatorDev = this;\n        if (self._filterFlags.added &&\n            changeSet.changes.added &&\n            changeSet.changes.added.length > 0) {\n            return changeSet;\n        }\n        if (self._filterFlags.removed &&\n            changeSet.changes.removed &&\n            changeSet.changes.removed.length > 0) {\n            return changeSet;\n        }\n        if (self._filterFlags.updated &&\n            changeSet.changes.merged &&\n            changeSet.changes.merged.length > 0) {\n            return changeSet;\n        }\n        return null;\n    },\n\n\n    findAtIndex: function(newModel): number {\n        return -1;\n    },\n\n    /**\n     * An internal method for listening to any change on the\n     * global provider. Listening to the sole update event is\n     * sufficient and efficent.\n     * @param {Object} args\n     */\n    onGlobalProviderUpdate: function() {\n        /*jslint unparam:true */\n        const self: IWritableListMediatorDev = this;\n        const args = arguments;\n\n        // If we are loading data, the data we are receiving is\n        // the result of the current loading behavior.\n        // We do not need to do anything. Instead, the loading behavior\n        // is responsible for rending data.\n        if (self._isLoadingData) {\n            return;\n        }\n        // Shortcircuit\n        const changeSet = self.globalProviderFilter.apply(self, args);\n        if (!changeSet) {\n            return;\n        }\n        // The interface of changeSet is determined by the above filter\n        // method. However, the below view provider listener must be careful.\n        // Changes\n        if (changeSet.add) {\n            const candidate = _.filter(changeSet.changes.added, function(thisItem) {\n                return !_.some(self._viewLevelData.models, function(thatItem) {\n                    return thisItem.id === thatItem.id;\n                });\n            });\n            if (candidate.length > 0) {\n                _.each(candidate, function(v, k) {\n                    const atIndex = self.findAtIndex(v);\n                    if (atIndex !== -1) {\n                        self._viewLevelData.add(v, { at: atIndex });\n                    } else {\n                        self._viewLevelData.add(v);\n                    }\n                });\n            }\n        }\n        if (changeSet.remove) {\n            self._viewLevelData.remove(changeSet.changes.removed);\n        }\n        if (changeSet.merge) {\n            // Keep propagating\n            self._viewLevelData.trigger('update', changeSet.changes);\n        }\n    },\n\n    /**\n     * An internal method for listening to the change on the view\n     * data provider. Usually, such kind of listening shall be stopped\n     * when there is no view binding to the current midiator list.\n     * @param {Object} args\n     */\n    onViewProviderUpdate: function(evtCtx: any, changeSet: IChangeSet, rest: any): void {\n        /*jslint unparam:true */\n        const self: IWritableListMediatorDev = this;\n        const $data = self._viewInstance.$data;\n        let newData: any;\n        // Note that the interface of changeSet varies from\n        // events to events in Backbone. We have to be very careful.\n        if (changeSet.changes.added && changeSet.changes.added.length > 0) {\n            // Check if we have data or not\n            newData = self.generateItemsInternal(changeSet.changes.added);\n            self.onUpdateView({\n                add: true,\n                source: 'event',\n                data: newData\n            });\n            $data.asyncPrepend(newData);\n        }\n        if (changeSet.changes.removed && changeSet.changes.removed.length > 0) {\n            newData = self.generateItemsInternal(changeSet.changes.removed);\n            self.onUpdateView({\n                remove: true,\n                source: 'event',\n                data: newData\n            });\n            $data.asyncPop(newData);\n        }\n        if (changeSet.changes.merged && changeSet.changes.merged.length > 0) {\n            newData = self.generateItemsInternal(changeSet.changes.merged);\n            self.onUpdateView({\n                merge: true,\n                source: 'event',\n                data: newData\n            });\n            $data.asyncRefresh(newData);\n        }\n    },\n\n    /**\n     * Override.\n     * So that we can clean up the view data.\n     */\n    loadInitData: function() {\n        const self: IWritableListMediatorDev = this;\n        self._viewLevelData.reset();\n        return self._super();\n    },\n\n\n    /**\n     * Starts to listen to the change on the global provider.\n     * It is usually used internally on setting up this mediator.\n     * @param {Object} globalProvider\n     */\n    startListeningGlobalProvider: function(globalProvider) {\n        const self: IWritableListMediatorDev = this;\n        const onUpdate = function() {\n            const args = arguments;\n            // We have to schedule such update so that some other operations can\n            // been completed first. E.g., getForeignModel should be set up.\n            _.defer(function() {\n                self.onGlobalProviderUpdate.apply(self, args);\n            });\n        };\n        self._globalProviderListeners = {\n            update: onUpdate\n        };\n        self._globalProvider = globalProvider;\n        globalProvider.on('update', onUpdate);\n    },\n\n    /**\n     * Stops listening to the change on the global provider.\n     * It is usally used on the tearing down this mediator.\n     */\n    stopListeningGlobalProvider: function() {\n        const self: IWritableListMediatorDev = this;\n        const listeners = self._globalProviderListeners;\n        const globalProvider = self._globalProvider;\n        for (const key in listeners) {\n            if (listeners.hasOwnProperty(key)) {\n                globalProvider.off(key, listeners[key]);\n            }\n        }\n    },\n\n    /**\n     * Start to listen to the change on the view data provider.\n     * This method is invoked on binding a view to this mediator.\n     */\n    startListeningViewProvider: function() {\n        const self: IWritableListMediatorDev = this;\n        const onUpdate = function(evtCtx, changeSet, rest) {\n            self.onViewProviderUpdate(evtCtx, changeSet, rest);\n        };\n        self._viewProviderListeners = {\n            update: onUpdate\n        };\n        self._viewLevelData.on('update', onUpdate);\n    },\n\n    /**\n     * Stops listening to the change on the view data provider.\n     * This method is invoked on unbinding a view to this mediator.\n     */\n    stopListeningViewProvider: function() {\n        const self: IWritableListMediatorDev = this;\n        const listeners = self._viewProviderListeners;\n        for (const key in listeners) {\n            if (listeners.hasOwnProperty(key)) {\n                self._viewLevelData.off(key, listeners[key]);\n            }\n        }\n    },\n\n    /**\n     * Override.\n     * Compared its base counterpart, this method performs additional\n     * checking on generating data for the view module, so that no repeated\n     * items may be generated.\n     * Simply because, the data in the view level data is distinct.\n     * @returns {Array}\n     */\n    safelyReadDataProvider: function(): any[] {\n        const self: IWritableListMediatorDev = this;\n        let models = self._super();\n        models = _.filter(models, function(elem) {\n            return !_.some(self._viewLevelData.models, function(item) {\n                return item.id === elem.id;\n            });\n        });\n        // Safely push these models into view level data provider\n        self._viewLevelData.add(models, { silent: true });\n        // Then return\n        return models;\n    },\n\n    /**\n     * Override.\n     * This method uses the data from the view level data, instead of the\n     * the current remote data provider, to generate the list of data\n     * to be rendered.\n     */\n    renderData: function(async?: boolean) {\n        const self: IWritableListMediatorDev = this;\n        const $data = self._viewInstance.$data;\n        $data.clean();\n        $data.hasMoreData(self._dataProvider.hasNextPage());\n        const newData = self.generateItemsInternal(self._viewLevelData.models);\n        if (async === true) {\n            $data.asyncPush(newData);\n        } else {\n            $data.syncPush(newData);\n        }\n    },\n\n    /**\n     * Override\n     * @param {} options\n     */\n    setUp: function(options) {\n        const self: IWritableListMediatorDev = this;\n        self._super(options);\n        if (self._globalProvider) {\n            self.startListeningGlobalProvider(self._globalProvider);\n        }\n    },\n\n    /**\n     * Override\n     */\n    tearDown: function() {\n        const self: IWritableListMediatorDev = this;\n        // Call super\n        self._super();\n        // Tear off what we introduce in this class\n        self._viewLevelData.off('all');\n        self._viewLevelData.reset();\n        // Stop listening to the global\n        if (self._globalProvider) {\n            self.stopListeningGlobalProvider();\n        }\n    },\n\n    /**\n     * Override\n     */\n    attachView: function(viewInstance) {\n        const self: IWritableListMediatorDev = this;\n        self._super(viewInstance);\n        // Start to listen to changes on the view data provider.\n        self.startListeningViewProvider();\n    },\n\n    /**\n     * Override\n     */\n    detachView: function() {\n        const self: IWritableListMediatorDev = this;\n        self._super();\n        self.stopListeningViewProvider();\n    }\n});\n","import { fromEvent, Subscription } from 'rxjs';\nimport { debounceTime, buffer, map } from 'rxjs/operators';\n\nimport * as hInterface from '@polpware/fe-dependencies';\n\nimport { pushArray } from '@polpware/fe-utilities';\n\nimport {\n    IWritableListMediatorDev,\n    IChangeSet,\n    WritableListMediator,\n    IWritableListMediatorCtorOptions\n} from './writable-abstract-list';\n\nconst _ = hInterface.underscore;\n\nexport interface IRxjsPoweredDirContentMediatorDev extends IWritableListMediatorDev {\n    _emitEventDelay: number;\n    _globalSubr: Subscription;\n}\n\ninterface IFullChangeSet extends IChangeSet {\n    add: boolean;\n    remove: boolean;\n    merge: boolean;\n}\n\nfunction mergeArgs(data: any[]): IChangeSet {\n    const finalSet: IFullChangeSet = {\n        add: false,\n        remove: false,\n        merge: false,\n        changes: {\n            added: [],\n            removed: [],\n            merged: []\n        }\n    };\n    data.forEach((elem: any[]) => {\n        const changeSet: IChangeSet = elem[1];\n        if (changeSet.changes.added && changeSet.changes.added.length > 0) {\n            pushArray(finalSet.changes.added, changeSet.changes.added);\n            finalSet.add = true;\n        }\n        if (changeSet.changes.removed && changeSet.changes.removed.length > 0) {\n            pushArray(finalSet.changes.removed, changeSet.changes.removed);\n            finalSet.remove = true;\n        }\n        if (changeSet.changes.merged && changeSet.changes.merged.length > 0) {\n            pushArray(finalSet.changes.merged, changeSet.changes.merged);\n            finalSet.merge = true;\n        }\n    });\n\n    return finalSet;\n}\n\nexport const RxjsPoweredWritableListMediator = WritableListMediator.extend({\n    Properties: 'globalSubr, emitEventDelay',\n\n    init: function(settings: IWritableListMediatorCtorOptions) {\n        const self: IRxjsPoweredDirContentMediatorDev = this;\n        self._super(settings);\n        self._globalSubr = null;\n        self._emitEventDelay = 1000;\n    },\n\n    /**\n         * Starts to listen to the change on the global provider.\n         * It is usually used internally on setting up this mediator.\n         * @param {Object} globalProvider\n         */\n    startListeningGlobalProvider: function(globalProvider) {\n        const self: IRxjsPoweredDirContentMediatorDev = this;\n        self._globalProvider = globalProvider;\n\n        const eventObserver = fromEvent(globalProvider, 'update');\n        const ctrlObserver = eventObserver.pipe(debounceTime(self._emitEventDelay));\n\n        self._globalSubr = eventObserver.pipe(\n            buffer(ctrlObserver),\n            map((col) => {\n                const x = mergeArgs(col);\n                return x;\n            })\n        ).subscribe(args => {\n            self.onGlobalProviderUpdate.apply(self, [null, args]);\n        });\n    },\n\n    /**\n        * Stops listening to the change on the global provider.\n        * It is usally used on the tearing down this mediator.\n        */\n    stopListeningGlobalProvider: function() {\n        const self: IRxjsPoweredDirContentMediatorDev = this;\n        const globalProvider = self._globalProvider;\n        if (self._globalSubr) {\n            self._globalSubr.unsubscribe();\n            self._globalSubr = null;\n        }\n    }\n\n});\n\n","import * as dependencies from '@polpware/fe-dependencies';\n\nconst ClassBuilder = dependencies.Class;\n\n\nexport const ListControllerCtor = ClassBuilder.extend({\n\n    Defaults: {\n        MediatorCtor: null\n    },\n\n    Properties: 'mediator,settings',\n\n    /**\n     * Constructor\n     * @param {Object} settings\n     */\n    init: function(settings) {\n        var self = this;\n        // We expect the following properties\n\n        self._settings = settings;\n        self._isFirstTimeRendered = true;\n        self._mediator = settings.mediator || null;\n        self._mediatorFromCache = !!self._mediator;\n    },\n\n    initMediator: function() {\n        var self,\n            settings,\n            mediator,\n            MediatorCtor;\n        self = this;\n        if (self._mediator) {\n            return self;\n        }\n        settings = self._settings;\n        MediatorCtor = self.Defaults.MediatorCtor;\n        mediator = new MediatorCtor(settings);\n        // Setup mediator\n        self.setupMediator(mediator);\n\n        self._mediator = mediator;\n        return self;\n    },\n\n    setupMediator: function(mediator) {\n        mediator.setUp();\n    },\n\n    start: function() {\n        var self,\n            settings,\n            mediator;\n\n        self = this;\n        settings = self._settings;\n        mediator = self._mediator;\n\n        // Set up destroy\n        settings.$render.destroy(function() {\n            mediator.stopService();\n        });\n\n        settings.$render.ready(function() {\n            if (self._isFirstTimeRendered) {\n                self._isFirstTimeRendered = false;\n                mediator.startService(settings, self._mediatorFromCache);\n            }\n        });\n    }\n});\n\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["_","ClassBuilder","liftIntoPromise","hInterface"],"mappings":"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"}